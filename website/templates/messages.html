{% extends "base.html" %}
{% block title %}Messages{% endblock %}

{% block content %}
<h1>Messages</h1>

<!-- Send Message Form -->
<form method="POST">
    {{ form.hidden_tag() }}
    <div>
        {{ form.receiver.label }}<br>
        {{ form.receiver(class="form-control") }}
    </div>
    <div style="margin-top:10px;">
        {{ form.content.label }}<br>
        {{ form.content(class="form-control", rows="3") }}
    </div>
    <div style="margin-top:10px;">
        {{ form.submit(class="btn btn-purple") }}
    </div>
</form>

<hr>

<!-- Inbox and Sent -->
<div class="mb-3" id="accordion">
    <div class="card bg-dark text-white">
        <div class="card-header">
            <button class="btn btn-custom btn-block text-left" data-toggle="collapse" data-target="#inboxCollapse" aria-expanded="true" aria-controls="inboxCollapse">
                Inbox
            </button>
        </div>
        <div id="inboxCollapse" class="collapse show" data-parent="#accordion">
            <div class="card-body">
                {% if inbox %}
                    <ul>
                    {% for msg in inbox %}
                        <li><strong>From:</strong> {{ msg.sender.email }} - {{ msg.content }} <small>{{ msg.timestamp }}</small></li>
                    {% endfor %}
                    </ul>
                {% else %}
                    <p>No messages yet.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="card bg-dark text-white mt-2">
        <div class="card-header">
            <button class="btn btn-custom btn-block text-left" data-toggle="collapse" data-target="#sentCollapse" aria-expanded="false" aria-controls="sentCollapse">
                Sent
            </button>
        </div>
        <div id="sentCollapse" class="collapse" data-parent="#accordion">
            <div class="card-body">
                {% if sent %}
                    <ul>
                    {% for msg in sent %}
                        <li><strong>To:</strong> {{ msg.receiver.email }} - {{ msg.content }} <small>{{ msg.timestamp }}</small></li>
                    {% endfor %}
                    </ul>
                {% else %}
                    <p>You havenâ€™t sent any messages yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}